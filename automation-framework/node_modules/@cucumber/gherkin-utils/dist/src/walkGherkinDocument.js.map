{"version":3,"file":"walkGherkinDocument.js","sourceRoot":"","sources":["../../src/walkGherkinDocument.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\nimport * as messages from '@cucumber/messages'\n\nimport { GherkinDocumentHandlers } from './GherkinDocumentHandlers'\n\n/**\n * Walks a Gherkin Document, visiting each node depth first (in the order they appear in the source)\n *\n * @param gherkinDocument\n * @param initialValue the initial value of the traversal\n * @param handlers handlers for each node type, which may return a new value\n * @return result the final value\n */\nexport function walkGherkinDocument<Acc>(\n  gherkinDocument: messages.GherkinDocument,\n  initialValue: Acc,\n  handlers: Partial<GherkinDocumentHandlers<Acc>>\n): Acc {\n  const commentsStack = gherkinDocument.comments.slice()\n  let acc = initialValue\n  const h: GherkinDocumentHandlers<Acc> = { ...makeDefaultHandlers<Acc>(), ...handlers }\n  const feature = gherkinDocument.feature\n  acc = walkComments(popCommentsUntil(feature?.location), acc)\n  if (!feature) return acc\n  acc = walkTags(feature.tags || [], acc)\n  acc = h.feature(feature, acc)\n\n  for (const child of feature.children) {\n    if (child.background) {\n      acc = walkStepContainer(child.background, acc)\n    } else if (child.scenario) {\n      acc = walkStepContainer(child.scenario, acc)\n    } else if (child.rule) {\n      acc = walkTags(child.rule.tags || [], acc)\n      acc = walkComments(popCommentsUntil(child.rule.location), acc)\n      acc = h.rule(child.rule, acc)\n      for (const ruleChild of child.rule.children) {\n        if (ruleChild.background) {\n          acc = walkStepContainer(ruleChild.background, acc)\n        } else if (ruleChild.scenario) {\n          acc = walkStepContainer(ruleChild.scenario, acc)\n        }\n      }\n    }\n  }\n  acc = walkComments(popRemainingContents(), acc)\n  return acc\n\n  function walkComments(comments: readonly messages.Comment[], acc: Acc): Acc {\n    return comments.reduce((acc, comment) => h.comment(comment, acc), acc)\n  }\n\n  function walkTags(tags: readonly messages.Tag[], acc: Acc): Acc {\n    return tags.reduce((acc, tag) => h.tag(tag, acc), acc)\n  }\n\n  function walkSteps(steps: readonly messages.Step[], acc: Acc): Acc {\n    return steps.reduce((acc, step) => walkStep(step, acc), acc)\n  }\n\n  function walkStep(step: messages.Step, acc: Acc): Acc {\n    acc = walkComments(popCommentsUntil(step.location), acc)\n    acc = h.step(step, acc)\n    if (step.docString) {\n      acc = h.docString(step.docString, acc)\n    }\n    if (step.dataTable) {\n      acc = h.dataTable(step.dataTable, acc)\n      acc = walkTableRows(step.dataTable.rows, acc)\n    }\n    return acc\n  }\n\n  function walkTableRows(tableRows: readonly messages.TableRow[], acc: Acc): Acc {\n    return tableRows.reduce((acc, tableRow) => walkTableRow(tableRow, acc), acc)\n  }\n\n  function walkTableRow(tableRow: messages.TableRow, acc: Acc): Acc {\n    acc = h.tableRow(tableRow, acc)\n    return tableRow.cells.reduce((acc, tableCell) => h.tableCell(tableCell, acc), acc)\n  }\n\n  function walkStepContainer(\n    stepContainer: messages.Scenario | messages.Background,\n    acc: Acc\n  ): Acc {\n    acc = walkComments(popCommentsUntil(stepContainer.location), acc)\n    const scenario: messages.Scenario = 'tags' in stepContainer ? stepContainer : null\n    acc = walkTags(scenario?.tags || [], acc)\n    acc = scenario\n      ? h.scenario(scenario, acc)\n      : h.background(stepContainer as messages.Background, acc)\n    acc = walkSteps(stepContainer.steps, acc)\n\n    if (scenario) {\n      for (const examples of scenario.examples || []) {\n        acc = walkComments(popCommentsUntil(examples.location), acc)\n        acc = walkTags(examples.tags || [], acc)\n        acc = h.examples(examples, acc)\n        if (examples.tableHeader) {\n          acc = walkTableRow(examples.tableHeader, acc)\n          acc = walkTableRows(examples.tableBody || [], acc)\n        }\n      }\n    }\n    return acc\n  }\n\n  function popCommentsUntil(location?: messages.Location): readonly messages.Comment[] {\n    let count = 0\n    for (const comment of commentsStack) {\n      if (location === undefined || comment.location.line < location.line) {\n        count++\n      } else {\n        break\n      }\n    }\n    return commentsStack.splice(0, count)\n  }\n\n  function popRemainingContents(): readonly messages.Comment[] {\n    return commentsStack.splice(0, commentsStack.length)\n  }\n}\n\nfunction makeDefaultHandlers<Acc>() {\n  const defaultHandlers: GherkinDocumentHandlers<Acc> = {\n    feature(feature, acc) {\n      return acc\n    },\n    background(background, acc) {\n      return acc\n    },\n    rule(rule, acc) {\n      return acc\n    },\n    scenario(scenario, acc) {\n      return acc\n    },\n    step(step, acc) {\n      return acc\n    },\n    examples(examples, acc) {\n      return acc\n    },\n    tag(tag, acc) {\n      return acc\n    },\n    comment(comment, acc) {\n      return acc\n    },\n    dataTable(dataTable, acc) {\n      return acc\n    },\n    tableRow(tableRow, acc) {\n      return acc\n    },\n    tableCell(tableCell, acc) {\n      return acc\n    },\n    docString(docString, acc) {\n      return acc\n    },\n  }\n  return defaultHandlers\n}\n"]}